global
log stdout format raw daemon
maxconn 100
stats socket /tmp/haproxy.sock mode 600 level admin expose-fd listeners
stats timeout 30s

defaults
log global
mode tcp
option dontlognull
timeout connect 5s
timeout client 1m
timeout server 1m

listen stats
bind *:8404
mode http
stats enable
stats uri /
stats refresh 5s

frontend pgsql
bind *:5432
default_backend pg_backends

backend pg_backends
mode tcp
balance first
option tcp-check
tcp-check connect

server replica postgres_replica:5432 check inter 2s rise 2 fall 3
server master postgres_master:5432 check inter 2s rise 2 fall 3 disabled
